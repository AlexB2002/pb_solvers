
\chapter{Theory}



\section{PB-AM formulation}

PB-AM is an analytical solution to the linearized Poisson-Boltzmann equations for multiple spherical objects of arbitrary charge distribution in an ionic solution.  The linearized Poisson-Boltzmann equation is given as:

\[ \nabla [\epsilon(r) \nabla\phi(r)] - \epsilon(r) \kappa^2\phi(r) = 4 \pi \rho(r) \] %∇[ϵ(r)∇Φ(r)]-ϵ(r) κ^2 Φ(r)=4πρ(r)

\[ \phi_{out}^{(i)}= \phi_{out}^{(i)} \biggr |_{r=a_i } \]

\[\epsilon_s \frac{\partial \phi_{out}^{(i)}}{\partial r} =   \epsilon_s \frac{\partial \phi_{out}^{(i)}}{\partial r} \biggr |_{r=a_i } \]

Exploiting fast-multipole methods, this boundary value problem can be reduced to the following system of linear equations.  

\[ A = \Gamma \cdot (\Delta \cdot T \cdot A + E) \]

A(i) represents the effective multipole expansion of the charge distributions of molecule (i). E(i) is the free charge distribution of molecule (i). $\Gamma$ is a dielectric boundary-crossing operator, $\Delta$ a cavity polarization operator, T an operator that transforms the multipole expansion to a local coordinate frame.  More details on the method are available in Lotan, Head-Gordon (2006). \\

\subsection{Physical Calculations}

From the above formulation, computation of the interaction energies ($\Omega^{(i)}$) is given as follows:

\[\Omega^{(i)}=\frac{1}{\epsilon_s} \left \langle \sum_{j \ne i}^N  T \cdot A^{(j) } ,  A^{(i) } \right \rangle \]

Where $\langle  M, N \rangle$ denotes the inner product. When energy is computed, forces follow as:

\[ \textbf{F}^{(i)} = \nabla_i \Omega^{(i)}=\frac{1}{\epsilon_s} [ \langle \nabla_i \,T \cdot A^{(i) } ,  A^{(i) } \rangle +  \langle T \cdot A^{(i) } ,   \nabla_i \, A^{(i) } \rangle ]\]


% Additonally, the torque $\tau^{(i)}_j$ on molecule $i$ due to a charge $q^{(i)}_j$ is calculated as follows:
The method to calculate the torque $\boldsymbol{\tau}^{(i)}$ on molecule is outside the scope of this manual, but is discussed extensively in Lotan, Head-Gordon (2006).

\subsection{Brownian Dynamics}

Brownian dynamics simulations are implemented by treating each molecule as a Brownian particle experiencing a conservative force $\textbf{F}^{(i)}$ and torque $\boldsymbol{\tau}^{(i)}$, as well as friction and random force due to the solvent. The translation $\Delta r_i$ and rotation $\Delta \theta_i$ for a time step $\Delta t$ are then given by

\[\Delta r^{(i)} = \frac{D_{i, trans} \Delta t}{k_B T} \textbf{F}^{(i)} + \textbf{S}_i(\Delta t)\]
\[\Delta \theta^{(i)} = \frac{D_{i, rot} \Delta t}{k_B T} \boldsymbol{\tau}^{(i)} + \boldsymbol{\Theta}_i(\Delta t)\]

where $D_{i, trans}$ and $D_{i, rot}$ are the translation and rotational diffusion coefficients for molecule $i$, respectively and $\textbf{S}_i(\Delta t)$ and $\boldsymbol{\Theta}_i(\Delta t)$ are the stochastic components of translation and rotation, respectively, which have the following properties:

\[\langle \textbf{S}_i \rangle=0, \qquad \langle \textbf{S}_i^2 \rangle=2D_{i, trans}\Delta t\]
\[\langle \boldsymbol{\Theta}_i \rangle=0, \qquad \langle \boldsymbol{\Theta}_i^2 \rangle=2D_{i, rot}\Delta t\]

\subsection{Electrostatics}

In a similar manner to the interaction energy calculations in the Physical Calculations section, the electrostatics computes the potential at any point in space exterior to the molecules as the interaction energy 

\[\Phi_{out}(r)= \frac{1}{\epsilon_s} \left \langle \sum_{j = 1}^N  T \cdot A^{(j) } ,  A(r)  \right \rangle \]

\clearpage


\chapter{Use}

\section{Installation}

To install this program, first download the source code from the GitHub repository: \\

\hspace{1cm}\texttt{\$ git clone https://github.com/davas301/pb\_solvers.git} \\

Then navigate to the directory \texttt{pb\_solvers/pbam}. From here, make a \texttt{build} and \texttt{bin} directory, use CMake to create a make file and then make the program.  This is done as follows: \\

\hspace{1cm}\texttt{\$ cd pb\_solvers/pbam} 

\hspace{1cm}\texttt{\$ mkdir build bin}

\hspace{1cm}\texttt{\$ cd build}

\hspace{1cm}\texttt{\$ cmake ..} 

\hspace{1cm}\texttt{\$ make install} \\


An executable named \texttt{pbam} will now be in \texttt{pb\_solvers/bin}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Input Information}

\subsubsection{Input Files}

The program executable requires an input file as a command line parameter. The input file contains the various arguments and parameters that one may wish to set when running the program. Each line of the input file contains a keyword followed by a variable number of whitespace-delimited parameters, e.g.: \\

\texttt{keyword1\qquad param1\qquad param2} \\
\texttt{keyword2\qquad param1\qquad param2\qquad param3} \\

Each keyword is described in the table below, along with its associated parameters.


\newcommand{\param}[1]{$\textless\texttt{#1}\textgreater$}
\newcommand\T{\rule{0pt}{3.5ex}}       % Top strut
\newcommand\B{\rule[-2ex]{0pt}{0pt}}

\newlength{\colthree}
\setlength{\colthree}{10.1cm}
\newlength{\coltwo}
\setlength{\coltwo}{2.9cm}

\begin{tabular}{ c | l | l  }
    \textbf{Keyword} & \textbf{Parameters} & \textbf{Description} \\ \hline
\T runname & \param{name} & \parbox[t]{\colthree}{\param{name} is desired internal name of this run.} \\
\T pqr & \param{fpath} & \parbox[t]{\colthree}{Provide input PQR file at \param{fpath}.} \\
\T xyz & \param{fpath} & \parbox[t]{\colthree}{Provide input XYZ file at \param{fpath}.} \\
\T salt & \param{con} & \parbox[t]{\colthree}{Set salt concentration in the system to \param{con}.}\\
\T temp & \param{T} & \parbox[t]{\colthree}{Set system temperature to \param{T}}\\
\T idiel & \param{ival} & \parbox[t]{\colthree}{Set the interior dielectric constant to \param{ival}.} \\
\T sdiel & \param{sval} & \parbox[t]{\colthree}{Set the interior dielectric constant to \param{sval}.} \\
\T pbc & \param{boxlength} & \parbox[t]{\colthree}{Set size of periodic box to \param{boxlength}.}\\
\T random & \param{seed} & \parbox[t]{\colthree}{Seed the internal random number generator with \param{seed}.} \\
\T attypes & \param{numtypes} & \parbox[t]{\colthree}{Set the number of different atom types to \param{numtypes}.}\\
\T type & \parbox[t]{\coltwo}{\param{idx} \param{ct} \param{movetype} \param{dtr} \param{drot}} & \parbox[t]{\colthree}{Set attributes of an atom type, where \param{idx} is the integer id of this type, which can be 1 to \param{numtypes} (above). \param{ct} is the number of atoms of this type in the system and \param{movetype} describes the way this type is allowed to move in a dynamics run (\texttt{move}, \texttt{rot}, or \texttt{stat}). If \param{movetype} is \texttt{move}, then a translational diffusion coefficient \param{dtr} and a rotational diffusional coefficient \param{drot} are required. If \param{movetype} is \texttt{rot} then just \param{drot} is required. \B}\\
\hline
\T runtype electrostatics & \param{gridpts} & \parbox[t]{\colthree}{Will run electrostatics calculations. \param{gridpts} is an optional integer describing the number of evenly spaced points in each dimension to perform calculations on.}\\
\T dx & \param{fname} & \parbox[t]{\colthree}{For electrostatics. Will write the results of electrostatics calculations for every 3D grid point to \param{fname}.} \\
\T gridct & \param{ct} & \parbox[t]{\colthree}{For electrostatics. \param{ct} is the number of 2D grids to output.} \\
\T grid2d & \parbox[t]{\coltwo}{\param{idx} \param{fname} \param{axis} \param{val} } & \parbox[t]{\colthree}{For electrostatics. Set attributes of a grid output where \param{idx} is the integer id of this grid, which can be 1 to \param{ct} (above). Will write output of calculations for a cross section along \param{axis} (\texttt{x}, \texttt{y}, or \texttt{z}) at \param{value}.\B} \\
\hline
\T runtype dynamics & & \parbox[t]{\colthree}{Will perform a brownian dynamics run.\B}  \\
\T termct & \param{ct} & \parbox[t]{\colthree}{Set number of termination conditions to \param{ct}.}  \\
\T termcombine & \param{andor} & \parbox[t]{\colthree}{Set how termination conditions will be combined. \param{andor} should be \texttt{and} or \texttt{or}. Default is \texttt{or}.} \\
\T term & \parbox[t]{\coltwo}{\param{idx} \param{type} \param{val} \param{mols}} & \parbox[t]{\colthree}{Set attributes of a termination condition where \param{idx} is the integer id of this condition, which can be 1 to \param{ct} (above). \param{type} can be \texttt{time}, \texttt{contact},  \texttt{x<=}, \texttt{y<=}, \texttt{z<=}, or \texttt{r<=} (or the \texttt{>=} equivalents of these), \param{val} is the value where the simulation will terminate and \param{mols} is a whitespace-delimited list of molecular indices that this condition applies to (\texttt{contact} requires 2, \texttt{time} requires 0, and all else require 1). \B} \\
\hline
  \end{tabular}

\subsubsection{System inputs}

All the options above require a PQR file name. A PQR file can be generated from a PDB file using the PDB2PQR program, available as a web server or for download at: \\

http://nbcr-222.ucsd.edu/pdb2pqr\_1.9.0/  \\
http://www.poissonboltzmann.org/docs/pdb2pqr-installation/ \\

It may also be formatted manually. The general format of a PQR file is as follows, and is whitespace-delimited: \\

\texttt{recName  serial  atName  resName  chainID  resNum  X  Y  Z  charge rad }\\

  \begin{tabular}{ c | l  }
    \textbf{Parameter} & \textbf{Description} \\ \hline
\texttt{recName} 	&	A string that should either be ATOM or HETATM. \\
\texttt{serial} 	&	An integer that provides the atom index \\
\texttt{atName} 	&	A string that provides the atom name.\\
\texttt{resName}	&	A string that provides the residue name. \\
\texttt{chainID}	&	An optional string that provides the chain ID of the atom.\\
\texttt{residueNumber}  & An integer that provides the residue index.\\
\texttt{X Y Z}	& Three floats that provide the atomic coordinates.\\
\texttt{charge}	& A float that provides the atomic charge (in electrons). \\
\texttt{Rad}		& A float that provides the atomic radius (in \AA…).\\
    \hline
  \end{tabular}


\clearpage

