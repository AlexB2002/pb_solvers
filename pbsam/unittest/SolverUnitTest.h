//
//  SolverUnitTest.h
//  pbsam
//
//  Created by Felberg, Lisa on 6/8/16.
//  Copyright Â© 2016 Felberg, Lisa. All rights reserved.
//

#ifndef SolverUnitTest_h
#define SolverUnitTest_h

#include "Solver.h"

/*
 Class for unit testing solver matrices
 */
class SolverUTest : public ::testing::Test
{
  protected :

  double doubleFactorial[10] = {};
  
  virtual void SetUp()   {}
  virtual void TearDown() {}
  
  vector<double> unifSphX = {0,-0.18316353,-1.13466223,-0.774928921,0.495848189,1.61237984,1.8612696,1.14746377,-0.156480449,-1.4940578,-2.37498141,-2.52333083,-1.91787625,-0.750787101,0.658708071,1.96181151,2.86388476,3.18022946,2.85943835,1.97715718,0.707641383,-0.717540469,-2.05438631,-3.08714395,-3.65928912,-3.69180533,-3.18812857,-2.22704831,-0.946216319,0.480328887,1.86701765,3.04064737,3.86059092,4.23339289,4.1207209,3.54049941,2.56180284,1.2946653,-0.123652629,-1.54421956,-2.822101,-3.8305985,-4.47281266,-4.68965428,-4.46383607,-3.81978192,-2.81975739,-1.55682794,-0.145473043,1.28918468,2.62253561,3.74106928,4.55155167,4.98812757,5.01689251,4.63770724,3.88325614,2.81556221,1.52035094,0.0997941696,-1.33574493,-2.67630499,-3.82060754,-4.68343155,-5.20158165,-5.33807398,-5.08430677,-4.46013402,-3.51191024,-2.30871056,-0.937048064,0.505500569,1.91729125,3.19973568,4.26406532,5.03728977,5.46697055,5.5245207,5.20684529,4.53625142,3.55867,2.34033992,0.963200123,-0.480687263,-1.8953051,-3.18703271,-4.2707691,-5.07543802,-5.54853062,-5.65940731,-5.40116254,-4.79094869,-3.86875327,-2.69472006,-1.34519484,0.092245509,1.52446088,2.85875137,4.00881644,4.90029385,5.47553031,5.69728378,5.55112444,5.04638203,4.21557759,3.11237213,1.80815693,0.387495894,-1.05729682,-2.43210454,-3.64710621,-4.62263705,-5.29443499,-5.61793048,-5.5712938,-5.15702896,-4.40199262,-3.35581557,-2.08780618,-0.682514561,0.765773637,2.15926969,3.40324144,4.41247033,5.11717183,5.46796997,5.43956813,5.03283532,4.27512568,3.21876275,1.93774302,0.522837764,-0.924611197,-2.29980349,-3.50202297,-4.44208418,-5.04914034,-5.27633281,-5.10482262,-4.54584131,-3.6405272,-2.45746657,-1.08802792,0.360249436,1.7717868,3.03204879,4.03689912,4.70148712,4.96791259,4.81096574,4.24134957,3.30596081,2.0850244,0.686132045,-0.764488659,-2.13287489,-3.28955168,-4.12203328,-4.54643674,-4.51701545,-4.03250428,-3.13837049,-1.92438099,-0.517314625,0.930860805,2.25850111,3.31213105,3.96482814,4.13304802,3.78968626,2.97130982,1.77790766,0.364214552,-1.07737341,-2.3411131,-3.23703691,-3.62128906,-3.42317106,-2.66395736,-1.4627984,-0.0261507747,1.38073599,2.47872499,3.03080825,2.89998095,2.09626212,0.79824792,-0.664484132,-1.87667667,-2.44851428,-2.154569,-1.06208228,0.410513807,1.57547761,1.75422007,0.73935628,-0.742758359,-1.09609283,0.385479294,0};
  vector<double> unifSphY = {0,0.785006186,0.0744670248,-1.15288574,-1.52114697,-0.763881213,0.579590343,1.75897105,2.233832,1.8383576,0.749628614,-0.647634264,-1.91988665,-2.71506072,-2.84003488,-2.2822982,-1.18620616,0.199573568,1.58603467,2.70451183,3.35378235,3.42815727,2.92550409,1.93752593,0.626810511,-0.803817139,-2.1440806,-3.20634287,-3.84936662,-3.99352466,-3.62665729,-2.801025,-1.62278504,-0.236073429,1.19590734,2.51038337,3.56291861,4.24199991,4.47910333,4.25363542,3.59271241,2.5662417,1.27816648,-0.144993831,-1.56703617,-2.85511677,-3.89176327,-4.58486683,-4.87492104,-4.73906714,-4.1918057,-3.28252018,-2.09020624,-0.715996637,0.725794045,2.11731321,3.34670855,4.31682465,4.95243015,5.20549467,5.05820699,4.52360911,3.64390144,2.48663972,1.13918456,-0.29812863,-1.7195631,-3.02173321,-4.11098341,-4.90989015,-5.36246313,-5.43772744,-5.13148925,-4.46621685,-3.4890971,-2.26844665,-0.888760165,0.555240941,1.9651412,3.24550055,4.31021902,5.08818584,5.527858,5.60048992,5.30182814,4.65218633,3.69492016,2.49342289,1.12685335,-0.315115138,-1.73817911,-3.04954182,-4.16391048,-5.00897499,-5.53002517,-5.69342038,-5.4886991,-4.92920173,-4.05117351,-2.91140855,-1.58358689,-0.15353712,1.28627624,2.64269317,3.82785194,4.76485753,5.39276508,5.67055988,5.57987617,5.12627456,4.33898663,3.26913095,1.98650119,0.575118159,-0.872181462,-2.25978215,-3.49556985,-4.49705131,-5.19691172,-5.5476386,-5.52489289,-5.12938323,-4.3870912,-3.34780036,-2.08199204,-0.676281009,0.772334094,2.1630433,3.3981923,4.39017496,5.06777246,5.3814811,5.3074251,4.84953363,4.03977099,2.93633806,1.61990432,0.188074012,-1.25157256,-2.58940134,-3.72205526,-4.56057994,-5.03771385,-5.11374195,-4.7803886,-4.06234755,-3.01620844,-1.72673206,-0.300636982,1.1417253,2.47622866,3.58561579,4.3700561,4.7566875,4.70722666,4.22282838,3.34555379,2.15606222,0.767459639,-0.684403414,-2.05351833,-3.19816936,-3.99593284,-4.35770678,-4.23918139,-3.64824723,-2.64709916,-1.34823265,0.0958725569,1.50886581,2.7111387,3.5428792,3.8868659,3.6878872,2.96559236,1.81793299,0.413194933,-1.03003749,-2.27386406,-3.09981181,-3.35005237,-2.96402796,-2.00240143,-0.650478529,0.804798067,2.02617363,2.70148778,2.63109766,1.80685177,0.455255473,-0.984682596,-1.9714139,-2.05964334,-1.14809398,0.325569054,1.41883961,1.17386983,-0.302628838,-0.707947248,0};
  vector<double> unifSphZ = {-5.7,-5.64271357,-5.58542714,-5.5281407,-5.47085427,-5.41356784,-5.35628141,-5.29899497,-5.24170854,-5.18442211,-5.12713568,-5.06984925,-5.01256281,-4.95527638,-4.89798995,-4.84070352,-4.78341709,-4.72613065,-4.66884422,-4.61155779,-4.55427136,-4.49698492,-4.43969849,-4.38241206,-4.32512563,-4.2678392,-4.21055276,-4.15326633,-4.0959799,-4.03869347,-3.98140704,-3.9241206,-3.86683417,-3.80954774,-3.75226131,-3.69497487,-3.63768844,-3.58040201,-3.52311558,-3.46582915,-3.40854271,-3.35125628,-3.29396985,-3.23668342,-3.17939698,-3.12211055,-3.06482412,-3.00753769,-2.95025126,-2.89296482,-2.83567839,-2.77839196,-2.72110553,-2.6638191,-2.60653266,-2.54924623,-2.4919598,-2.43467337,-2.37738693,-2.3201005,-2.26281407,-2.20552764,-2.14824121,-2.09095477,-2.03366834,-1.97638191,-1.91909548,-1.86180905,-1.80452261,-1.74723618,-1.68994975,-1.63266332,-1.57537688,-1.51809045,-1.46080402,-1.40351759,-1.34623116,-1.28894472,-1.23165829,-1.17437186,-1.11708543,-1.05979899,-1.00251256,-0.945226131,-0.887939698,-0.830653266,-0.773366834,-0.716080402,-0.65879397,-0.601507538,-0.544221106,-0.486934673,-0.429648241,-0.372361809,-0.315075377,-0.257788945,-0.200502513,-0.14321608,-0.0859296482,-0.0286432161,0.0286432161,0.0859296482,0.14321608,0.200502513,0.257788945,0.315075377,0.372361809,0.429648241,0.486934673,0.544221106,0.601507538,0.65879397,0.716080402,0.773366834,0.830653266,0.887939698,0.945226131,1.00251256,1.05979899,1.11708543,1.17437186,1.23165829,1.28894472,1.34623116,1.40351759,1.46080402,1.51809045,1.57537688,1.63266332,1.68994975,1.74723618,1.80452261,1.86180905,1.91909548,1.97638191,2.03366834,2.09095477,2.14824121,2.20552764,2.26281407,2.3201005,2.37738693,2.43467337,2.4919598,2.54924623,2.60653266,2.6638191,2.72110553,2.77839196,2.83567839,2.89296482,2.95025126,3.00753769,3.06482412,3.12211055,3.17939698,3.23668342,3.29396985,3.35125628,3.40854271,3.46582915,3.52311558,3.58040201,3.63768844,3.69497487,3.75226131,3.80954774,3.86683417,3.9241206,3.98140704,4.03869347,4.0959799,4.15326633,4.21055276,4.2678392,4.32512563,4.38241206,4.43969849,4.49698492,4.55427136,4.61155779,4.66884422,4.72613065,4.78341709,4.84070352,4.89798995,4.95527638,5.01256281,5.06984925,5.12713568,5.18442211,5.24170854,5.29899497,5.35628141,5.41356784,5.47085427,5.5281407,5.58542714,5.64271357,5.7};
  
public:
  SolverUTest( ) {  }
  
};


TEST_F(SolverUTest, UniSphGrid)
{
  int grid = 200;
  vector<Pt> grids = make_uniform_sph_grid(grid, 5.7);
  
  for (int i = 0; i < grid; i++)
  {
    EXPECT_NEAR( grids[i].x(), unifSphX[i], preclim);
    EXPECT_NEAR( grids[i].y(), unifSphY[i], preclim);
    EXPECT_NEAR( grids[i].z(), unifSphZ[i], preclim);
  }
}

TEST_F(SolverUTest, IMATTest1)
{
  int pol = 5;
  PQRFile pqr(test_dir_loc + "test_2sp.pqr");
  auto mol = make_shared<Molecule>(0, 0, "stat", pqr.get_charges(),
                                   pqr.get_atom_pts(), pqr.get_radii(),
                                   pqr.get_cg_centers(), pqr.get_cg_radii());
  auto _SHConstTest = make_shared<SHCalcConstants> (2*pol);
  auto SHCalcTest = make_shared<SHCalc> (2*pol, _SHConstTest);
  IEMatrix ieMatTest(10, mol, SHCalcTest, pol);
  
  ASSERT_EQ( mol->get_gdpt_expj(0).size(), 52604 );
  ASSERT_EQ( mol->get_gdpt_burj(0).size(), 19396 );
  ASSERT_EQ( mol->get_gdpt_expj(1).size(), 52600 );
  ASSERT_EQ( mol->get_gdpt_burj(1).size(), 19400 );
  
//  for (int i = 0; i < grid; i++)
//  {
//    EXPECT_NEAR( grids[i].x(), unifSphX[i], preclim);
//    EXPECT_NEAR( grids[i].y(), unifSphY[i], preclim);
//    EXPECT_NEAR( grids[i].z(), unifSphZ[i], preclim);
//  }
//  for (int i = 0; i < grid; i++)
//  {
//    cout << setprecision(9) << grid_pts[i].y()<< "," ;
//  }cout << endl;cout << endl;
}

#endif /* SolverUnitTest_h */
